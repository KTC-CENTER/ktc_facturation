{% extends 'base.html.twig' %}

{% block title %}Paiement - {{ invoice.reference }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="mb-6">
        <nav class="text-sm text-gray-500 mb-2">
            <a href="{{ path('app_invoice_index') }}" class="hover:text-primary-600">Factures</a>
            <span class="mx-2">/</span>
            <a href="{{ path('app_invoice_show', {id: invoice.id}) }}" class="hover:text-primary-600">{{ invoice.reference }}</a>
            <span class="mx-2">/</span>
            <span class="text-gray-700">Paiement</span>
        </nav>
        <h1 class="text-2xl font-bold text-gray-900">Enregistrer un paiement</h1>
    </div>

    <div class="card">
        <div class="card-body">
            <!-- Résumé facture -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">Facture</span>
                    <span class="font-semibold">{{ invoice.reference }}</span>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">Client</span>
                    <span class="font-semibold">{{ invoice.client.name }}</span>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600">Total TTC</span>
                    <span class="font-semibold">{{ invoice.totalTTCFloat|number_format(0, ',', ' ') }} FCFA</span>
                </div>
                {% if invoice.amountPaidFloat > 0 %}
                <div class="flex justify-between items-center mb-2 text-green-600">
                    <span>Déjà payé</span>
                    <span class="font-semibold">{{ invoice.amountPaidFloat|number_format(0, ',', ' ') }} FCFA</span>
                </div>
                {% endif %}
                <div class="flex justify-between items-center pt-2 border-t border-gray-200">
                    <span class="text-gray-900 font-semibold">Reste à payer</span>
                    <span class="text-xl font-bold text-primary-600">{{ invoice.remainingAmountFloat|number_format(0, ',', ' ') }} FCFA</span>
                </div>
            </div>

            <!-- Formulaire -->
            <form method="post" action="{{ path('app_invoice_payment', {id: invoice.id}) }}">
                <input type="hidden" name="_token" value="{{ csrf_token('payment' ~ invoice.id) }}">
                
                <div class="space-y-4">
                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Montant du paiement *</label>
                        <div class="relative">
                            <input type="number" name="amount" id="amount" 
                                   value="{{ invoice.remainingAmountFloat }}" 
                                   min="1" max="{{ invoice.remainingAmountFloat }}" step="1"
                                   class="form-input pr-16" required>
                            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">FCFA</span>
                        </div>
                    </div>

                    <div>
                        <label for="payment_method" class="block text-sm font-medium text-gray-700 mb-1">Mode de paiement</label>
                        <select name="payment_method" id="payment_method" class="form-select">
                            <option value="">-- Sélectionner --</option>
                            <option value="cash">Espèces</option>
                            <option value="bank_transfer">Virement bancaire</option>
                            <option value="mobile_money">Mobile Money</option>
                            <option value="check">Chèque</option>
                            <option value="card">Carte bancaire</option>
                            <option value="other">Autre</option>
                        </select>
                    </div>

                    <div>
                        <label for="payment_reference" class="block text-sm font-medium text-gray-700 mb-1">Référence du paiement</label>
                        <input type="text" name="payment_reference" id="payment_reference" 
                               placeholder="N° de transaction, chèque, etc."
                               class="form-input">
                    </div>
                </div>

                <div class="flex items-center justify-end gap-3 mt-6 pt-4 border-t border-gray-200">
                    <a href="{{ path('app_invoice_show', {id: invoice.id}) }}" class="btn btn-secondary">Annuler</a>
                    <button type="submit" class="btn btn-success">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Enregistrer le paiement
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
